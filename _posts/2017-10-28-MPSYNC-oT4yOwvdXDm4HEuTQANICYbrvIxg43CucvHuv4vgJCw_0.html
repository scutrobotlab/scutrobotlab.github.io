---
categories: [新闻]
date: 2017-10-28 00:47:38 +0800
desc: 还没做完的小伙伴，恭喜你！你跟视觉绝缘了。
layout: mp-sync
slug: 视觉任务1技术思路大揭秘
tags: [微信公众号文章]
title: 视觉任务1技术思路大揭秘
...

<p style="margin-bottom: 10px;"><span style="font-family:宋体;"></span></p><p style="margin-bottom: 10px;"><img style="" data-ratio="0.18683001531393567" data-type="gif" data-w="653" data-copyright="0" data-src="/static/assets/img/mp-sync/uia5dweZ372LocjVclKdf4WEw3g5Doy9OOJz7ia7LjZhOyQtTm6yguIYMJAKXicZBxeKSx0iamaTOoNHPKUgdTjfew.gif"></p><p style="margin-bottom: 10px;"><span style="font-family:宋体;"></span><br></p><p style="margin-bottom: 10px;"><span style="font-family:宋体;">实习期已经过去两个星期了，小伙伴们都已经完成了我们的视觉任务</span>1<span style="font-family:宋体;">。在这个过程中我们也见识到了非常多的骚操作。直接</span><span style="color: rgb(0, 122, 170);font-family: 宋体;text-decoration: none;"><strong>灰度化</strong></span><span style="font-family:宋体;">这种操作我也看到了（甚至效果还挺好...），这说明成斌师兄出的这道题还是太水了。但是灰度化相当于完全无视橙色这个先验条件，是非常不推荐的操作，而且<span style="color: rgb(0, 122, 170);font-family: 宋体;"><strong>因为不同颜色的灰度可能是一样的</strong></span>，可能会有如下</span>bug<span style="font-family:宋体;">：</span></p><p style="margin-bottom: 10px;"><span style="font-family:宋体;"><br></span></p><p style="text-align: center;margin-bottom: 10px;"><img style="" data-ratio="0.6624423963133641" data-type="gif" data-w="868" data-copyright="0" data-src="/static/assets/img/mp-sync/uia5dweZ372LKSgQEaMrHrTiaW7uTbPclfEK70a2waTSkbQsyqs2AvyXXTwgic6tNTYKpwiaq4MeRucCRnYMrTkBFw.gif"></p><p style="text-align: center;margin-bottom: 10px;"><span style="font-size: 14px;color: rgb(136, 136, 136);">灰度化操作</span></p><p style="text-align: center;"><br></p><p style="margin-bottom: 10px;"><span style="font-family:宋体;">当然，这里演示的属于极端情况。但是这种操作还是会让我觉得很难受啊！因为这种做法真的不够好啊！</span></p><p style="margin-bottom: 10px;"> </p><p style="margin-bottom: 10px;"><span style="font-family:宋体;">因为我们其实有<strong><span style="color: rgb(0, 122, 170);font-family: 宋体;">两个先验信息：橙色、小球</span></strong>，最好的方案当然是两个条件都用上，所以基本上的思路还是</span><strong><span style="color: rgb(0, 122, 170);"><span style="font-family: 宋体;">预处理</span>+<span style="font-family: 宋体;">霍夫圆</span></span></strong><span style="font-family:宋体;">。但鉴于很多小伙伴还停留在玄学调参的程度上，我们现在简单告诉大家一下这个预处理的思路。</span></p><p style="margin-bottom: 10px;"> </p><p style="text-align: center;margin-bottom: 10px;"><span style="font-size: 18px;"><strong><span style="font-size: 18px;font-family: 宋体;color: rgb(0, 122, 170);">分割：inRange函数</span></strong></span></p><p style="margin-bottom: 10px;"><span style="font-family:宋体;">https://docs.opencv.org/trunk/da/d97/tutorial_threshold_inRange.html</span></p><p style="margin-bottom: 10px;"><span style="font-family:宋体;">分割是图像处理中最常见的操作。其中最简单的方案就是用设定阈值的方法进行二值分割。很多小伙伴们都学会了</span>inRange<span style="font-family:宋体;">函数分割，但是大家可能还不是很懂怎么调参数，这里教大家一种简单的方法。</span></p><p style="margin-bottom: 10px;"><span style="font-family:宋体;">打开</span>Photoshop<span style="font-family:宋体;">的“</span><span style="color: rgb(0, 122, 170);text-decoration: none;"><span style="font-family: 宋体;text-decoration: none;"><strong>窗口</strong></span><strong>-</strong><strong><span style="font-family: 宋体;text-decoration: none;">直方图</span></strong></span><span style="font-family:宋体;">”，然后用</span><span style="color: rgb(0, 122, 170);font-family: 宋体;text-decoration: none;"><strong>选择工具</strong></span><span style="font-family: 宋体;text-decoration: none;"><strong>选择</strong></span><span style="font-family:宋体;"><strong>图片中的橙色小球<span style="color: rgb(0, 122, 170);font-family: 宋体;">（一定要选择小球啊！）</span></strong>，然后看一下直方图的情况。</span></p><p style="text-align: left;margin-bottom: 10px;"><span style="font-family:宋体;">你可以拿<strong>鼠标选中直方图</strong>的一部分，然后读</span><span style="color: rgb(0, 122, 170);font-family: 宋体;text-decoration: none;"><strong>色阶</strong></span><span style="font-family:宋体;">，这就是你们要用到的参数范围啦</span>~</p><p style="white-space: normal;text-align: center;margin-bottom: 10px;"><img data-ratio="0.7942122186495176" data-type="gif" data-w="311" data-copyright="0" data-src="/static/assets/img/mp-sync/uia5dweZ372LKSgQEaMrHrTiaW7uTbPclfibUdRibicaweYlvRic6OVwmicghvVj6y2aBC9ZWFKTUjTcdr5sA7MQC7RiaQ.gif"></p><p style="white-space: normal;text-align: center;margin-bottom: 10px;"><span style="font-size: 14px;color: rgb(136, 136, 136);">Photoshop选择直方图范围</span></p><p style="white-space: normal;text-align: center;margin-bottom: 10px;"><span style="font-size: 14px;color: rgb(136, 136, 136);"><br></span></p><p style="margin-bottom: 10px;"><span style="font-family:宋体;">没有</span>Photoshop<span style="font-family:宋体;">的小伙伴也不要悲伤，</span>QQ<span style="font-family:宋体;">的截图工具也是可以读取</span>RGB<span style="font-family:宋体;">的。滑过橙色的部分，自行感受一下参数范围填进去就可以了。</span></p><p style="margin-bottom: 10px;"><span style="font-family:宋体;"></span></p><p style="text-align: center;margin-bottom: 10px;"><img style="" data-ratio="0.8544891640866873" data-type="gif" data-w="323" data-copyright="0" data-src="/static/assets/img/mp-sync/uia5dweZ372LKSgQEaMrHrTiaW7uTbPclfLicoUic8bwSklWoaMQopMlcChOLLTnlgHw28lSeW2eHmn6mdicYiaictjeA.gif"></p><p style="text-align: center;margin-bottom: 10px;"><span style="font-size: 14px;color: rgb(136, 136, 136);">QQ截图工具</span></p><p style="margin-bottom: 10px;"> <br><span style="font-family:宋体;"></span></p><p style="text-align: center;margin-bottom: 10px;"><span style="font-size: 18px;"><strong><span style="font-family: 宋体;color: rgb(0, 122, 170);">通道操作</span></strong></span></p><p style="margin-bottom: 10px;"><span style="font-family:宋体;">因为霍夫圆其实自带了边缘检测，如果你给它一张二值图实在是有点浪费啊</span>……<span style="font-family:宋体;">二值操作本身就比较暴力，丢失大量信息的同时，也生成了很多多余的边缘。</span></p><p style="margin-bottom: 10px;"><img style="" data-ratio="0.5797819623389494" data-type="gif" data-w="1009" data-copyright="0" data-src="/static/assets/img/mp-sync/uia5dweZ372LKSgQEaMrHrTiaW7uTbPclfgwegibcyMuibySic2V2TRKdtl9nI0E6XCFiasUDw1ZERS8mjkNq7XZQV3A.gif"></p><p style="text-align: center;margin-bottom: 10px;"><span style="font-size: 14px;color: rgb(136, 136, 136);">对阴影进行的二值化操作</span></p><p><br></p><p style="margin-bottom: 10px;"><span style="font-family:宋体;">比如说阴影等放射渐变在二值化的时候可能会产生一个多余的圆。其实边缘也是一个很重要的条件，<strong><span style="color: rgb(0, 122, 170);font-family: 宋体;">我们还是希望尽量保留边缘信息：哪些区域是同一个物体，从边缘可以很好区分。</span></strong></span></p><p style="margin-bottom: 10px;"> </p><p style="margin-bottom: 10px;"><span style="font-family:宋体;">我们可以用</span>OpenCV<span style="font-family:宋体;">的</span>split<span style="font-family:宋体;">函数把通道分开，然后检查一下它们各自的情况。</span></p><p style="margin-bottom: 10px;"><img style="" data-ratio="0.5460992907801419" data-type="gif" data-w="1410" data-copyright="0" data-src="/static/assets/img/mp-sync/uia5dweZ372LKSgQEaMrHrTiaW7uTbPclfjLwHxia0dSzAR8DeVr2r4swHhBoLxf2t4VMBkVduCnkd6UjEav2DbVw.gif"></p><p style="text-align: center;margin-bottom: 10px;"><span style="font-size: 14px;color: rgb(136, 136, 136);">HSV和BGR个通道情况</span></p><p><br></p><p style="margin-bottom: 10px;"><span style="font-family:宋体;">我们可以看到，在</span>R<span style="font-family:宋体;">和</span>V<span style="font-family:宋体;">通道中，圆形的小球和背景差异度较高。所以直接拿<strong><span style="color: rgb(0, 122, 170);font-family: 宋体;">R和V通道相乘</span></strong>做就已经可以了。</span></p><p style="margin-bottom: 10px;"><span style="font-family:宋体;">由于橙色的</span>H<span style="font-family:宋体;">值非常低。可以用</span>R*V*(180-H)<span style="font-family:宋体;">的方法，就能获得非常好的预处理结果。</span></p><p style="margin-bottom: 10px;"><span style="font-family:宋体;">也可以直接取</span>R<span style="font-family:宋体;">通道。考虑到白色的东西</span>R<span style="font-family:宋体;">值也是很高的，所以我们常常会采用</span>R-B<span style="font-family:宋体;">和</span>R-G<span style="font-family:宋体;">的方法来去掉白色像素。对于这道题的情况（橙色的东西</span>G<span style="font-family:宋体;">通道是有一点值的），更推荐采用</span>R-B<span style="font-family:宋体;">。</span></p><p style="margin-bottom: 10px;"> </p><p style="text-align: center;margin-bottom: 10px;"><span style="font-size: 18px;"><strong><span style="font-size: 18px;font-family: 宋体;color: rgb(0, 122, 170);">遍历操作</span></strong></span></p><p style="margin-bottom: 10px;"><span style="font-family:宋体;">可能是受到</span>RM<span style="font-family:宋体;">官方推送的影响，还有非常多的同学采用了遍历的方法。这是图像处理中最基本的操作，但推送写得过于简单，直接在原图像上操作像素其实是不合理的。正确的做法是用一个</span>Mat::zeros()<span style="font-family:宋体;">函数创建一个</span>mask<span style="font-family:宋体;">掩模，然后把信息记录到这里面。</span></p><p style="margin-bottom: 10px;"><span style="font-family:宋体;">它的原理上相当于弄了一个函数</span> f (R, G,B)<span style="font-family:宋体;">，这个函数的输出代表它有多大概率是橙色的。还是受</span>RM<span style="font-family:宋体;">推送的影响，大家会很多用到阶跃函数，直接就</span>if (R &gt; 200) <span style="font-family:宋体;">这样操作，原理上跟</span>inRange<span style="font-family:宋体;">没什么差别。</span></p><p style="margin-bottom: 10px;"><span style="font-family:宋体;">确定一个未知函数有一个非常骚的操作叫做<span style="color: rgb(0, 122, 170);font-family: 宋体;"><strong>机器学习</strong></span>，因为这道题实在是太水了，我们就用最最简单的</span>SVM<span style="font-family:宋体;">完成。我们的训练结果是：</span>-0.12*B-0.33*G+1.13*R<span style="font-family:宋体;">。效果如下：</span></p><p style="margin-bottom: 10px;"><span style="font-family:宋体;"></span></p><p style="text-align: center;margin-bottom: 10px;"><img style="" data-ratio="0.7483870967741936" data-type="gif" data-w="465" data-copyright="0" data-src="/static/assets/img/mp-sync/uia5dweZ372LKSgQEaMrHrTiaW7uTbPclf3aazF2ASNUibCPDgtvbtDtyaUFwNudrkm7593QgbLyQvIBYqItqv87Q.gif"></p><p style="text-align: center;margin-bottom: 10px;"><span style="font-size: 14px;color: rgb(136, 136, 136);">测试结果</span></p><p><br></p><p style="margin-bottom: 10px;"><span style="font-family:宋体;"></span></p><p style="margin-bottom: 10px;"><span style="font-family:宋体;">最后，恭喜大家第一道题圆满完成。现在起，选择视觉方向的小伙伴，可以在群上领取你们的第二道题了。</span></p><p style="margin-bottom: 10px;">最后，<span style="font-family:宋体;">我想告诉大家的是，<span style="color: rgb(0, 122, 170);font-family: 宋体;"><strong>OpenCV里通道的顺序是BGR，不是RGB！！！</strong></span></span></p><p style="margin-bottom: 10px;"><span style="font-family:宋体;"><br></span></p><p style="margin-bottom: 10px;"><span style="font-family:宋体;"><br></span></p><p style="margin-bottom: 10px;"><span style="font-family:宋体;"></span></p><p style="margin-bottom: 10px;"><img style="" data-ratio="0.3333333333333333" data-type="jpeg" data-w="1146" data-copyright="0" data-s="300,640" data-src="/static/assets/img/mp-sync/uia5dweZ372LoDWC5APkCoFAjIYmnrQHCh4QaWH9z1LSFvg4erEiaFy7gJ9ogtWV7SCTnSmIOfprVko1xG9IQRSQ.jpg"></p><p><br></p>